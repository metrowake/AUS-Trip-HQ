<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Around Me â€” AUS Trip</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" crossorigin=""/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" crossorigin=""/>

  <style>
    :root{
      --bg:#0B0B10;
      --panel:rgba(18,18,24,.86);
      --stroke:rgba(255,255,255,.10);
      --text:#F5F5F7;
      --muted:rgba(245,245,247,.68);
      --muted2:rgba(245,245,247,.48);
      --accent:#8B5CF6;
      --good:#22C55E;
      --shadow:0 14px 40px rgba(0,0,0,.45);
      --r:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:var(--bg);
      color:var(--text);
      overflow:hidden;
    }

    /* MAP = protagonista */
    #map{position:fixed; inset:0; z-index:1;}

    /* Top bar minimal */
    .topbar{
      position:fixed; left:12px; right:12px; top:12px; z-index:5;
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      pointer-events:none;
    }
    .topbar > *{pointer-events:auto}
    .brand{
      display:flex; flex-direction:column; gap:2px;
      padding:10px 12px;
      border:1px solid var(--stroke);
      border-radius:999px;
      background:var(--panel);
      backdrop-filter:blur(14px);
      box-shadow:var(--shadow);
      min-width: 220px;
    }
    .brand .t{font-weight:900; font-size:13px; line-height:1.1}
    .brand .s{font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .actions{display:flex; gap:8px; align-items:center}
    .btn{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      backdrop-filter:blur(14px);
      box-shadow:0 10px 28px rgba(0,0,0,.25);
      white-space:nowrap;
    }
    .btn.primary{background:rgba(139,92,246,.26); border-color:rgba(139,92,246,.55)}
    .btn:active{transform:translateY(1px)}
    .select{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      backdrop-filter:blur(14px);
      box-shadow:0 10px 28px rgba(0,0,0,.25);
      outline:none;
    }

    /* Bottom sheet: lista pulita */
    .sheet{
      position:fixed; left:0; right:0; bottom:0; z-index:6;
      height:44%;
      background:linear-gradient(180deg, rgba(16,16,22,.45), rgba(16,16,22,.92));
      border-top:1px solid var(--stroke);
      border-top-left-radius:24px;
      border-top-right-radius:24px;
      backdrop-filter:blur(16px);
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    .sheetHead{
      display:flex; gap:10px; align-items:center;
      padding:10px 12px 10px;
    }
    .grab{width:46px; height:5px; border-radius:99px; background:rgba(245,245,247,.18); margin:10px auto 0;}
    .search{
      flex:1; display:flex; gap:8px; align-items:center;
      padding:10px 12px;
      border:1px solid var(--stroke);
      border-radius:999px;
      background:rgba(255,255,255,.06);
    }
    .search input{width:100%; border:0; outline:none; background:transparent; color:var(--text); font-size:13px}
    .tabs{display:flex; border:1px solid var(--stroke); border-radius:999px; overflow:hidden; background:rgba(255,255,255,.04)}
    .tabs button{border:0; background:transparent; color:var(--muted); padding:10px 12px; font-size:12px; cursor:pointer}
    .tabs button.active{background:rgba(139,92,246,.20); color:var(--text)}

    .filtersRow{
      padding:0 12px 10px;
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      color:var(--muted);
      font-size:12px;
    }
    .chipRow{display:flex; gap:8px; overflow:auto; padding:0 12px 10px; -webkit-overflow-scrolling:touch}
    .chip{
      flex:0 0 auto;
      border:1px solid var(--stroke);
      border-radius:999px;
      padding:8px 10px;
      background:rgba(0,0,0,.18);
      color:var(--text);
      cursor:pointer;
      user-select:none;
      font-size:12px;
      white-space:nowrap;
    }
    .chip.active{border-color:rgba(139,92,246,.70); box-shadow:0 0 0 3px rgba(139,92,246,.18)}

    .cards{padding:0 12px 14px; overflow:auto; -webkit-overflow-scrolling:touch}
    .card{
      border:1px solid var(--stroke);
      border-radius:var(--r);
      background:rgba(255,255,255,.05);
      padding:12px;
      margin-bottom:10px;
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .icon{
      width:38px; height:38px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.25);
      display:flex; align-items:center; justify-content:center;
      flex:0 0 auto;
    }
    .main{min-width:0; flex:1}
    .name{font-weight:900; font-size:14px; margin:0 0 6px 0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .meta{display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:8px}
    .tag{border:1px solid var(--stroke); border-radius:999px; padding:6px 9px; font-size:12px; background:rgba(0,0,0,.12)}
    .desc{font-size:12px; color:var(--muted2); line-height:1.35; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden}
    .right{display:flex; flex-direction:column; gap:8px; align-items:flex-end; flex:0 0 auto}
    .aBtn{
      text-decoration:none;
      border:1px solid var(--stroke);
      border-radius:999px;
      padding:9px 10px;
      font-size:12px;
      color:var(--text);
      background:rgba(255,255,255,.06);
      display:inline-flex; align-items:center; gap:8px;
      justify-content:center;
      min-width:116px;
      cursor:pointer;
      user-select:none;
    }
    .aBtn.primary{border-color:rgba(139,92,246,.55); background:rgba(139,92,246,.20)}
    .aBtn.good{border-color:rgba(34,197,94,.45); background:rgba(34,197,94,.14)}

    /* small toast */
    .toast{
      position:fixed; left:12px; right:12px; top:66px; z-index:10;
      background:rgba(0,0,0,.55);
      border:1px solid var(--stroke);
      border-radius:999px;
      padding:10px 12px;
      font-size:13px;
      backdrop-filter:blur(14px);
      box-shadow:var(--shadow);
      display:none;
    }

    /* keep map clean */
    .leaflet-control-attribution{display:none}
    .leaflet-popup-content-wrapper{border-radius:14px; overflow:hidden}
  </style>
</head>
<body>

<div id="map"></div>

<div class="topbar">
  <div class="brand">
    <div class="t">Around Me</div>
    <div class="s" id="statusLine">Base: Hotel Sydney Â· Luoghi: â€”</div>
  </div>

  <div class="actions">
    <select class="select" id="baseSelect" aria-label="Base location">
      <option value="hotel_syd">Hotel Sydney (Shangriâ€‘La)</option>
      <option value="gps">GPS (se disponibile)</option>
      <option value="goldcoast">Gold Coast (area)</option>
      <option value="hamilton">Hamilton Island (area)</option>
      <option value="perth">Perth CBD (area)</option>
    </select>
    <button class="btn primary" id="btnRecenter">Center</button>
    <button class="btn" id="btnFit">Fit</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<div class="sheet" id="sheet">
  <div class="grab"></div>

  <div class="sheetHead">
    <div class="search">
      <span style="opacity:.85">ğŸ”</span>
      <input id="q" type="text" placeholder="Cerca un posto (nome o note)..." />
    </div>

    <div class="tabs">
      <button id="tabNear" class="active" type="button">Vicini</button>
      <button id="tabPicks" type="button">Consigliati</button>
      <button id="tabSaved" type="button">Salvati</button>
    </div>
  </div>

  <div class="filtersRow">
    <div id="subtitle">Vicini = ordinati per distanza dalla base</div>
    <div>
      Raggio:
      <select class="select" id="radius" style="padding:8px 10px; font-size:12px">
        <option value="2">2 km</option>
        <option value="5" selected>5 km</option>
        <option value="15">15 km</option>
        <option value="999">Tutto</option>
      </select>
    </div>
  </div>

  <div class="chipRow" id="chips"></div>
  <div class="cards" id="cards"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js" crossorigin=""></script>

<script>
/* ===== DATA (KMZ giÃ  "assorbito" nella lista): niente import/reset ===== */
const PLACES = [{"name": "Quokka spot", "lat": -31.9961082, "lng": 115.5414651, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "The Strand Arcade", "lat": -33.8693593, "lng": 151.2075288, "notes": "", "category": "ğŸ­ Culture"}, {"name": "Luna Palace Cinemas", "lat": -31.9361553, "lng": 115.8409936, "notes": "", "category": "ğŸ­ Culture"}, {"name": "Beaufort Street Books", "lat": -31.9367064, "lng": 115.8706087, "notes": "", "category": "ğŸ­ Culture"}, {"name": "Australian CinÃ©mathÃ¨que", "lat": -27.4708105, "lng": 153.0167762, "notes": "", "category": "ğŸ­ Culture"}, {"name": "Archives Fine Books", "lat": -27.4718602, "lng": 153.0256732, "notes": "", "category": "ğŸ­ Culture"}, {"name": "<![CDATA[Golden Age Cinema & Bar]]>", "lat": -33.8793807, "lng": 151.2111141, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "Kinokuniya Sydney", "lat": -33.8726763, "lng": 151.2072391, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Columbia Sportswear Sydney CBD", "lat": -33.8728903, "lng": 151.2073526, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Get Wasted", "lat": -33.8736963, "lng": 151.2070433, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Astor Theatre Perth", "lat": -31.934086, "lng": 115.872059, "notes": "", "category": "ğŸ­ Culture"}, {"name": "<![CDATA[Mojo's Bar]]>", "lat": -32.035395, "lng": 115.7532576, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "The Triffid", "lat": -27.4523211, "lng": 153.0419127, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "The Tivoli", "lat": -27.4521218, "lng": 153.0315037, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "The Lansdowne Hotel", "lat": -33.8847945, "lng": 151.1950215, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Twilight Hawkers Market", "lat": -31.9525996, "lng": 115.8592142, "notes": "", "category": "ğŸ­ Culture"}, {"name": "Fremantle Markets", "lat": -32.0562643, "lng": 115.7488507, "notes": "", "category": "ğŸ­ Culture"}, {"name": "The West End Markets", "lat": -27.4785093, "lng": 153.0049469, "notes": "", "category": "ğŸ­ Culture"}, {"name": "Eat Street Northshore", "lat": -27.4438961, "lng": 153.0797179, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Sydney Fish Market", "lat": -33.872907, "lng": 151.1927445, "notes": "", "category": "ğŸ­ Culture"}, {"name": "Carriageworks", "lat": -33.8933386, "lng": 151.1919461, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "The Palomar", "lat": -33.8821161, "lng": 151.2194132, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "NOUR", "lat": -33.8867209, "lng": 151.2138665, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Bar Wa Izakaya", "lat": -42.8785044, "lng": 147.3206601, "notes": "", "category": "ğŸ£ Asian"}, {"name": "Rogue Bistro", "lat": -27.4458535, "lng": 153.0439641, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Yoko Dining", "lat": -27.4624548, "lng": 153.0353139, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Sono Japanese Restaurant | Portside Wharf", "lat": -27.4411723, "lng": 153.0691907, "notes": "", "category": "ğŸ£ Asian"}, {"name": "<![CDATA[Dean & Nancy on 22]]>", "lat": -33.8653415, "lng": 151.2075587, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Palazzo Salato", "lat": -33.8697461, "lng": 151.2051313, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Bar Copains", "lat": -33.882972, "lng": 151.2112574, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "10 William St", "lat": -33.8858333, "lng": 151.2291667, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Aalia Restaurant Sydney", "lat": -33.8680725, "lng": 151.2093505, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "<![CDATA[Kuro Bar & Dining]]>", "lat": -33.870377, "lng": 151.2049956, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "ANTE", "lat": -33.8936607, "lng": 151.1836005, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Chu Bakery", "lat": -31.9393967, "lng": 115.8648493, "notes": "", "category": "â˜• Coffee"}, {"name": "La Veen Coffee - King Street", "lat": -31.9506052, "lng": 115.855681, "notes": "", "category": "â˜• Coffee"}, {"name": "Telegram Coffee", "lat": -31.9555, "lng": 115.8604036, "notes": "", "category": "â˜• Coffee"}, {"name": "Petition", "lat": -31.9554664, "lng": 115.8601202, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Fonzie Abbott", "lat": -27.4327236, "lng": 153.0452592, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "John Mills Himself", "lat": -27.4715771, "lng": 153.0254005, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Industry Beans Newstead", "lat": -27.4541007, "lng": 153.0417814, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Social Brew", "lat": -28.0893389, "lng": 153.4501667, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "Paddock Bakery", "lat": -28.076974, "lng": 153.44423, "notes": "", "category": "â˜• Coffee"}, {"name": "Brickfields Chippendale", "lat": -33.888583, "lng": 151.199792, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "A.P House (A.P Bakery)", "lat": -33.8793612, "lng": 151.2110565, "notes": "", "category": "â˜• Coffee"}, {"name": "Edition Roasters", "lat": -33.8785445, "lng": 151.2011511, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Reuben Hills", "lat": -33.8828778, "lng": 151.2110278, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Single O Newstead", "lat": -27.4456934, "lng": 153.0440937, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Bobeche", "lat": -31.9545295, "lng": 115.8552032, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "<![CDATA[Sneaky Tony's]]>", "lat": -31.9492226, "lng": 115.8576097, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Foxtrot Unicorn", "lat": -31.955218, "lng": 115.8569835, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Varnish on King", "lat": -31.9509514, "lng": 115.8554114, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Reef View Lounge", "lat": -20.3473128, "lng": 148.9563358, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "One Tree Hill", "lat": -20.3390478, "lng": 148.9531577, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "<![CDATA[Blackbird Bar, Dining & Events]]>", "lat": -27.4669036, "lng": 153.0308685, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "Death and Taxes Brisbane", "lat": -27.4699235, "lng": 153.0238736, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "elsewhere", "lat": -28.001681, "lng": 153.429232, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Lockwood Bar", "lat": -28.0888313, "lng": 153.4506566, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "The Cambus Wallace", "lat": -28.058335, "lng": 153.4385702, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "<![CDATA[The Balcony Bar & Oyster Co.]]>", "lat": -28.642004, "lng": 153.6126862, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "The Pass Cafe", "lat": -28.6380427, "lng": 153.6289509, "notes": "", "category": "â˜• Coffee"}, {"name": "The Lobo", "lat": -33.87, "lng": 151.205, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "PS40", "lat": -33.8685901, "lng": 151.204831, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Eau De Vie", "lat": -33.865455, "lng": 151.2068885, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "The Baxter Inn", "lat": -33.8696238, "lng": 151.2055976, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Cantina OK!", "lat": -33.8702181, "lng": 151.2051307, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Maybe Sammy", "lat": -33.8617706, "lng": 151.2069595, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Elizabeth Quay", "lat": -31.9575763, "lng": 115.8569874, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Perth Cultural Centre", "lat": -31.9497603, "lng": 115.860723, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Fremantle Prison", "lat": -32.0549838, "lng": 115.7536591, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "WA Museum Boola Bardip", "lat": -31.9495403, "lng": 115.8618542, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "Heart Reef Helipad", "lat": -20.3547249, "lng": 148.951106, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Heart Reef", "lat": -19.7754215, "lng": 149.2478054, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "South Bank Parklands", "lat": -27.4753665, "lng": 153.0208068, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Fortitude Valley", "lat": -27.457826, "lng": 153.0356579, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Gallery of Modern Art", "lat": -27.47056, "lng": 153.0171334, "notes": "", "category": "ğŸ­ Culture"}, {"name": "Queensland Art Gallery", "lat": -27.4724407, "lng": 153.0185946, "notes": "", "category": "ğŸ­ Culture"}, {"name": "Surfers Paradise", "lat": -27.9985041, "lng": 153.4227099, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Currumbin Rock Pools", "lat": -28.2049, "lng": 153.39586, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "HOTA Gallery", "lat": -28.0022881, "lng": 153.4167133, "notes": "", "category": "ğŸ­ Culture"}, {"name": "Byron Bay Lighthouse", "lat": -28.640137, "lng": 153.6345113, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Koala Hospital Track", "lat": -31.443093, "lng": 152.9193298, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Paddington Markets", "lat": -33.8872535, "lng": 151.2295995, "notes": "", "category": "ğŸ­ Culture"}, {"name": "The Rocks", "lat": -33.859062, "lng": 151.2080421, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Newtown", "lat": -33.8978149, "lng": 151.1785003, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Powerhouse Ultimo", "lat": -33.878518, "lng": 151.1995418, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "White Rabbit Gallery", "lat": -33.8865381, "lng": 151.2002712, "notes": "", "category": "ğŸ­ Culture"}, {"name": "Museum of Contemporary Art Australia", "lat": -33.8599358, "lng": 151.2090295, "notes": "", "category": "ğŸ­ Culture"}, {"name": "Sydney Opera House", "lat": -33.8567844, "lng": 151.2152967, "notes": "", "category": "ğŸ­ Culture"}, {"name": "Bib and Tucker", "lat": -32.0293967, "lng": 115.7491596, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "The Glenmore Hotel", "lat": -33.8586272, "lng": 151.2074295, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Manuka Woodfire Kitchen", "lat": -32.0534697, "lng": 115.7494022, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Bread in Common", "lat": -32.0562297, "lng": 115.74523, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Long Chim", "lat": -31.955667, "lng": 115.8600796, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Wildflower", "lat": -31.9557699, "lng": 115.8602658, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Pebble Beach at qualia", "lat": -20.3318595, "lng": 148.9482879, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "coca chu", "lat": -20.3445858, "lng": 148.9553974, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Bommie", "lat": -20.345381, "lng": 148.947615, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Hellenika at The Calile", "lat": -27.4566672, "lng": 153.0403757, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Gerardâ€™s Bistro", "lat": -27.4565453, "lng": 153.0389514, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Fatcow on James St", "lat": -27.4557306, "lng": 153.0390655, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Viscosity", "lat": -27.4565337, "lng": 153.0380734, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Gelato Messina Fortitude Valley", "lat": -27.4563548, "lng": 153.0400805, "notes": "", "category": "ğŸ¦ Gelato"}, {"name": "Space Furniture", "lat": -27.455285, "lng": 153.041598, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "The Running Company Newstead", "lat": -27.4548981, "lng": 153.042022, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Agnes Restaurant", "lat": -27.4579396, "lng": 153.0308917, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Etsu Izakaya", "lat": -28.0462647, "lng": 153.4350153, "notes": "", "category": "ğŸ£ Asian"}, {"name": "Little Truffle", "lat": -28.046044, "lng": 153.4349728, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "The Glenelg Public House", "lat": -28.045198, "lng": 153.434755, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "Social Eating House + Bar", "lat": -28.0306816, "lng": 153.4328686, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "Restaurant Labart", "lat": -28.0895999, "lng": 153.4495901, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "Rick Shores", "lat": -28.0894342, "lng": 153.4546263, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "The River Deck Cafe", "lat": -36.087311, "lng": 146.904241, "notes": "", "category": "â˜• Coffee"}, {"name": "Milk Haus", "lat": -35.3387487, "lng": 150.4184804, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "NOMAD Sydney", "lat": -33.8799057, "lng": 151.2103612, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "<![CDATA[Tio's Cerveceria]]>", "lat": -33.8796639, "lng": 151.2104344, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Mr. Wong", "lat": -33.8640567, "lng": 151.2078521, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "<![CDATA[Sean's]]>", "lat": -33.8895295, "lng": 151.2814818, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Firedoor Restaurant", "lat": -33.8816018, "lng": 151.2099232, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Ester Restaurant", "lat": -33.8874605, "lng": 151.2008331, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Saint Peter at The Grand National Hotel", "lat": -33.8863741, "lng": 151.2318567, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Quay Restaurant", "lat": -33.8575687, "lng": 151.2100844, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Bennelong", "lat": -33.8574468, "lng": 151.2147431, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Lesmurdie Falls National Park", "lat": -31.9950526, "lng": 116.0332615, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Yanchep National Park", "lat": -31.5486958, "lng": 115.6853314, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Nambung National Park", "lat": -30.5860819, "lng": 115.1541923, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Swan Valley", "lat": -31.8331879, "lng": 116.0032278, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Cottesloe Beach", "lat": -31.9938622, "lng": 115.7510477, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Kings Park", "lat": -31.9610037, "lng": 115.8414646, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Rottnest Island", "lat": -31.9965027, "lng": 115.5398997, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Lookout at One Tree Hill", "lat": -20.3388266, "lng": 148.9528154, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "One Tree Hill", "lat": -20.3390478, "lng": 148.9531577, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Hamilton Island", "lat": -20.3518817, "lng": 148.9572514, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Great Barrier Reef", "lat": -18.2870668, "lng": 147.6991918, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "Whitsunday Island", "lat": -20.2566514, "lng": 148.9779578, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Hill Inlet Lookout", "lat": -20.2458048, "lng": 149.0204633, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Whitehaven Beach", "lat": -20.2824324, "lng": 149.038854, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Glass House Mountains", "lat": -26.8979554, "lng": 152.9592759, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Moreton Island", "lat": -27.0873207, "lng": 153.4154233, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Mount Coot-tha", "lat": -27.475767, "lng": 152.9764734, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Lone Pine Koala Sanctuary", "lat": -27.5337818, "lng": 152.968815, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Tallebudgera Creek", "lat": -28.1366142, "lng": 153.4139917, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Currumbin Wildlife Sanctuary", "lat": -28.1355576, "lng": 153.4885428, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Burleigh Head National Park", "lat": -28.0918206, "lng": 153.4591743, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Lamington National Park", "lat": -28.2166667, "lng": 153.15, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Springbrook National Park", "lat": -28.2077209, "lng": 153.2903248, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Yuraygir National Park", "lat": -29.756839, "lng": 153.255352, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Dorrigo National Park", "lat": -30.3636107, "lng": 152.7290644, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Seal Rocks", "lat": -32.4352549, "lng": 152.5288309, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Murramarang Beach", "lat": -35.5245363, "lng": 150.4027909, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Murramarang Aboriginal Area", "lat": -35.5285625, "lng": 150.4021875, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "Murramarang Aboriginal Walking Track", "lat": -35.5305233, "lng": 150.3952797, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "Pebbly Beach", "lat": -35.6074678, "lng": 150.3264684, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Booderee National Park", "lat": -35.1338099, "lng": 150.6859962, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Hyams Beach", "lat": -35.1017041, "lng": 150.6922288, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Jervis Bay", "lat": -35.0463445, "lng": 150.6793451, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Barangaroo Reserve", "lat": -33.857208, "lng": 151.201206, "notes": "", "category": "ğŸ¸ Drinks"}, {"name": "Watsons Bay", "lat": -33.8450076, "lng": 151.2828553, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Ku-ring-gai Chase", "lat": -33.6186167, "lng": 151.264196, "notes": "", "category": "ğŸ½ï¸ Eat"}, {"name": "Ku-ring-gai Chase National Park", "lat": -33.6272215, "lng": 151.224358, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Bondi to Coogee Walk", "lat": -33.9183926, "lng": 151.2584756, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Royal National Park", "lat": -34.0736154, "lng": 151.0575107, "notes": "", "category": "ğŸŒ¿ Nature"}, {"name": "Blue Mountains National Park", "lat": -33.5931907, "lng": 150.535641, "notes": "", "category": "ğŸŒ¿ Nature"}];

const STORAGE_SAVED = "aus_trip_saved_v2";

/* Base locations (alcune sono "area" per semplicitÃ ) */
const BASES = {
  hotel_syd: { label:"Hotel Sydney (Shangriâ€‘La)", lat:-33.8619, lng:151.2069, zoom:14 },
  goldcoast: { label:"Gold Coast (area)", lat:-28.0167, lng:153.4000, zoom:12 },
  hamilton: { label:"Hamilton Island (area)", lat:-20.3533, lng:148.9620, zoom:13 },
  perth: { label:"Perth CBD (area)", lat:-31.9522, lng:115.8614, zoom:13 },
};

const CAT_ORDER = ["ğŸ½ï¸ Eat","ğŸ¸ Drinks","â˜• Coffee","ğŸŒ¿ Nature","ğŸ­ Culture","ğŸ¦ Gelato","ğŸ£ Asian","â›½ Fuel"];

let map, cluster, baseMarker;
let base = {...BASES.hotel_syd};
let activeCat = "all";
let mode = "near"; // near | picks | saved
let saved = new Set();

const elCards = document.getElementById("cards");
const elChips = document.getElementById("chips");
const elQ = document.getElementById("q");
const elToast = document.getElementById("toast");
const elStatus = document.getElementById("statusLine");
const elSubtitle = document.getElementById("subtitle");
const elRadius = document.getElementById("radius");
const elBaseSelect = document.getElementById("baseSelect");

const tabNear = document.getElementById("tabNear");
const tabPicks = document.getElementById("tabPicks");
const tabSaved = document.getElementById("tabSaved");

function toast(msg){
  elToast.textContent = msg;
  elToast.style.display = "block";
  clearTimeout(window.__t);
  window.__t = setTimeout(()=> elToast.style.display = "none", 2400);
}

function loadSaved(){
  try {
    const arr = JSON.parse(localStorage.getItem(STORAGE_SAVED) || "[]");
    saved = new Set(Array.isArray(arr) ? arr : []);
  } catch { saved = new Set(); }
}
function persistSaved(){ localStorage.setItem(STORAGE_SAVED, JSON.stringify(Array.from(saved))); }

function haversineKm(a,b){
  const R=6371, dLat=(b.lat-a.lat)*Math.PI/180, dLng=(b.lng-a.lng)*Math.PI/180;
  const lat1=a.lat*Math.PI/180, lat2=b.lat*Math.PI/180;
  const x=Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLng/2)**2;
  return 2*R*Math.asin(Math.sqrt(x));
}
function minsWalk(km){ return Math.max(1, Math.round((km/5)*60)); }

function mapsSearch(query){ return "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(query); }
function mapsDir(lat,lng){ return "https://www.google.com/maps/dir/?api=1&destination=" + encodeURIComponent(lat + "," + lng) + "&travelmode=walking"; }

function dayPart(){
  const h = new Date().getHours();
  if (h >= 6 && h < 11) return "mattina";
  if (h >= 11 && h < 16) return "pranzo";
  if (h >= 16 && h < 20) return "tramonto";
  return "sera";
}

function inferWhat(p){
  const c = p.category || "";
  if (c.includes("Nature")) return "Spot natura / panorama.";
  if (c.includes("Culture")) return "Luogo culturale / visita.";
  if (c.includes("Coffee")) return "CaffÃ¨ / bakery.";
  if (c.includes("Drinks")) return "Bar / cocktail.";
  if (c.includes("Gelato")) return "Gelato spot.";
  if (c.includes("Asian")) return "Asian spot.";
  if (c.includes("Fuel")) return "Stop tecnico (carburante).";
  return "Posto consigliato.";
}

function inferWhy(p){
  const dp = dayPart();
  const c = p.category || "";
  if (dp === "mattina" && c.includes("Coffee")) return "Perfetto per iniziare la giornata.";
  if (dp === "pranzo" && (c.includes("Eat") || c.includes("Asian"))) return "Buono come tappa pranzo.";
  if (dp === "tramonto" && c.includes("Nature")) return "Molto adatto alla golden hour.";
  if (dp === "sera" && c.includes("Drinks")) return "Ottimo in serata.";
  return "Buona tappa in zona.";
}

function qualityText(p){
  // Se hai note dal KMZ, le usiamo. Altrimenti generiamo micro-descrizione utile.
  const n = (p.notes || "").trim();
  if (n) return n;
  return `${inferWhat(p)} ${inferWhy(p)}`;
}

function scorePicks(p){
  // semplice: distanza + bias per fascia oraria
  let s = 0;
  s += Math.max(0, 24 - p.km * 8);

  const dp = dayPart();
  const c = p.category || "";
  const bias = {
    mattina: { "â˜• Coffee": 12, "ğŸ½ï¸ Eat": 4, "ğŸŒ¿ Nature": 6, "ğŸ­ Culture": 5, "ğŸ¸ Drinks": 0, "ğŸ¦ Gelato": 2, "ğŸ£ Asian": 3, "â›½ Fuel": -20 },
    pranzo:   { "ğŸ½ï¸ Eat": 10, "ğŸ£ Asian": 8, "â˜• Coffee": 6, "ğŸ­ Culture": 4, "ğŸŒ¿ Nature": 3, "ğŸ¸ Drinks": 1, "ğŸ¦ Gelato": 3, "â›½ Fuel": -20 },
    tramonto: { "ğŸŒ¿ Nature": 10, "ğŸ­ Culture": 6, "ğŸ¸ Drinks": 5, "ğŸ½ï¸ Eat": 6, "ğŸ¦ Gelato": 4, "â˜• Coffee": 2, "ğŸ£ Asian": 3, "â›½ Fuel": -20 },
    sera:     { "ğŸ¸ Drinks": 10, "ğŸ½ï¸ Eat": 9, "ğŸ£ Asian": 6, "ğŸ­ Culture": 5, "ğŸ¦ Gelato": 2, "â˜• Coffee": 0, "ğŸŒ¿ Nature": 0, "â›½ Fuel": -20 }
  };
  s += (bias[dp]?.[c] ?? 0);

  if (saved.has(p.id)) s += 2;
  return s;
}

function initMap(){
  map = L.map("map", { zoomControl:false });
  L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png", { maxZoom:20, subdomains:"abcd" }).addTo(map);
  L.control.zoom({ position:"bottomright" }).addTo(map);

  cluster = L.markerClusterGroup({
    showCoverageOnHover:false,
    spiderfyOnMaxZoom:true,
    maxClusterRadius:42
  });
  map.addLayer(cluster);

  baseMarker = L.circleMarker([base.lat, base.lng], {
    radius:10, weight:2, color:"#fff",
    fillColor:"#8B5CF6", fillOpacity:0.95
  }).addTo(map);

  map.setView([base.lat, base.lng], base.zoom || 13);
}

function fitAll(){
  const latlngs = PLACES.map(p => [p.lat, p.lng]);
  const bounds = L.latLngBounds(latlngs);
  map.fitBounds(bounds.pad(0.12));
}

function setBase(b){
  base = {...b};
  baseMarker.setLatLng([base.lat, base.lng]);
  elStatus.textContent = `Base: ${base.label} Â· Luoghi: â€”`;
  map.setView([base.lat, base.lng], base.zoom || 13);
  render();
}

function setMode(m){
  mode = m;
  tabNear.classList.toggle("active", m==="near");
  tabPicks.classList.toggle("active", m==="picks");
  tabSaved.classList.toggle("active", m==="saved");

  if (m==="near") elSubtitle.textContent = "Vicini = ordinati per distanza dalla base";
  if (m==="picks") elSubtitle.textContent = "Consigliati = distanza + fascia oraria (semplice, utile)";
  if (m==="saved") elSubtitle.textContent = "Salvati = la tua shortlist";

  render();
}

function buildChips(){
  const cats = new Map();
  for (const p of PLACES) cats.set(p.category, (cats.get(p.category)||0)+1);
  const ordered = ["all", ...CAT_ORDER.filter(c => cats.has(c)), ...Array.from(cats.keys()).filter(c => !CAT_ORDER.includes(c))];

  elChips.innerHTML = "";
  for (const c of ordered){
    const count = c === "all" ? PLACES.length : (cats.get(c) || 0);
    const label = c === "all" ? "âœ¨ Tutti" : c;
    const div = document.createElement("div");
    div.className = "chip" + ((activeCat === c) ? " active" : "");
    div.textContent = `${label} Â· ${count}`;
    div.addEventListener("click", () => { activeCat = c; buildChips(); render(); });
    elChips.appendChild(div);
  }
}

function computeList(){
  const q = (elQ.value || "").trim().toLowerCase();
  const radiusKm = Number(elRadius.value || 5);

  let list = PLACES;

  if (activeCat !== "all") list = list.filter(p => p.category === activeCat);
  if (q) list = list.filter(p => ((p.name||"") + " " + (p.notes||"")).toLowerCase().includes(q));

  // enrich with distance
  list = list.map((p) => {
    const km = haversineKm(base, p);
    return { ...p, km, min: minsWalk(km) };
  });

  // radius filter (solo per "Vicini" e "Consigliati" â€” sui "Salvati" lasciamo libertÃ )
  if (mode !== "saved" && radiusKm < 999) {
    list = list.filter(p => p.km <= radiusKm);
  }

  return list;
}

function renderMarkers(list){
  cluster.clearLayers();

  for (const p of list){
    const emoji = (p.category || "").split(" ")[0] || "ğŸ“";
    const icon = L.divIcon({
      className: "",
      html: `<div style="width:34px;height:34px;border-radius:999px;background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.18);display:flex;align-items:center;justify-content:center;backdrop-filter:blur(10px);box-shadow:0 10px 25px rgba(0,0,0,.25)">${emoji}</div>`,
      iconSize:[34,34], iconAnchor:[17,17]
    });

    const m = L.marker([p.lat, p.lng], { icon });
    const open = mapsSearch(p.name);
    const nav = mapsDir(p.lat, p.lng);
    const savedTxt = saved.has(p.id) ? "â˜… Salvato" : "â˜† Salva";

    const popup = `
      <div style="font-family:system-ui;line-height:1.25;max-width:260px">
        <div style="font-weight:900;margin-bottom:6px">${p.name}</div>
        <div style="color:rgba(0,0,0,.65);font-size:12px;margin-bottom:8px">${p.category} Â· ${Math.round(p.km*10)/10} km Â· ${p.min} min</div>
        <div style="color:rgba(0,0,0,.65);font-size:12px;margin-bottom:10px">${qualityText(p)}</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <a href="${nav}" target="_blank" rel="noopener" style="text-decoration:none;color:white;background:#8B5CF6;padding:7px 10px;border-radius:999px;font-size:12px">Naviga</a>
          <a href="${open}" target="_blank" rel="noopener" style="text-decoration:none;color:white;border:1px solid rgba(0,0,0,.15);background:rgba(0,0,0,.06);padding:7px 10px;border-radius:999px;font-size:12px">Apri</a>
          <a href="#" onclick="window.__toggleSaved('${p.id}');return false;" style="text-decoration:none;color:white;border:1px solid rgba(0,0,0,.15);background:rgba(0,0,0,.06);padding:7px 10px;border-radius:999px;font-size:12px">${savedTxt}</a>
        </div>
      </div>
    `;
    m.bindPopup(popup);
    cluster.addLayer(m);
  }
}

function card(p){
  const emoji = (p.category || "").split(" ")[0] || "ğŸ“";
  const inSaved = saved.has(p.id);

  const open = mapsSearch(p.name);
  const nav = mapsDir(p.lat, p.lng);

  const desc = qualityText(p);

  return `
    <div class="card">
      <div class="icon">${emoji}</div>
      <div class="main">
        <div class="name" title="${p.name}">${p.name}</div>
        <div class="meta">
          <span class="tag">${p.category}</span>
          <span class="tag">${Math.round(p.km*10)/10} km</span>
          <span class="tag">${p.min} min</span>
        </div>
        <div class="desc">${desc}</div>
      </div>
      <div class="right">
        <a class="aBtn primary" href="${nav}" target="_blank" rel="noopener">ğŸ§­ Naviga</a>
        <a class="aBtn" href="${open}" target="_blank" rel="noopener">â†— Apri</a>
        <a class="aBtn good" href="#" onclick="window.__toggleSaved('${p.id}');return false;">${inSaved ? "â˜… Salvato" : "â˜† Salva"}</a>
        <a class="aBtn" href="#" onclick="window.__focus(${p.lat},${p.lng});return false;">ğŸ“ Mostra</a>
      </div>
    </div>
  `;
}

function render(){
  // stable ids
  if (!PLACES.__inited){
    for (let i=0;i<PLACES.length;i++) PLACES[i].id = "p_" + i;
    PLACES.__inited = true;
  }

  let list = computeList();

  // build view by mode
  if (mode === "saved") {
    list = list.filter(p => saved.has(p.id));
    list.sort((a,b) => (a.km - b.km));
  } else if (mode === "picks") {
    list = list.map(p => ({...p, score: scorePicks(p)}));
    list.sort((a,b) => b.score - a.score);
    list = list.slice(0, 18);
  } else {
    // near
    list.sort((a,b) => a.km - b.km);
    list = list.slice(0, 40);
  }

  // status line
  const shown = list.length;
  const total = PLACES.length;
  elStatus.textContent = `Base: ${base.label} Â· Luoghi: ${shown}/${total}`;

  // markers + cards
  renderMarkers(list);
  elCards.innerHTML = list.map(card).join("");
}

window.__focus = (lat,lng) => { map.setView([lat,lng], Math.max(map.getZoom(), 15)); };
window.__toggleSaved = (id) => {
  if (saved.has(id)) { saved.delete(id); toast("Rimosso dai salvati"); }
  else { saved.add(id); toast("Salvato"); }
  persistSaved();
  render();
};

/* ===== Wiring ===== */
function wire(){
  document.getElementById("btnFit").addEventListener("click", () => { fitAll(); toast("Fit (tutti i luoghi)"); });
  document.getElementById("btnRecenter").addEventListener("click", () => {
    map.setView([base.lat, base.lng], base.zoom || 13);
    toast("Centrato sulla base");
  });

  tabNear.addEventListener("click", () => setMode("near"));
  tabPicks.addEventListener("click", () => setMode("picks"));
  tabSaved.addEventListener("click", () => setMode("saved"));

  elQ.addEventListener("input", () => render());
  elRadius.addEventListener("change", () => render());

  elBaseSelect.addEventListener("change", async () => {
    const v = elBaseSelect.value;

    if (v === "gps") {
      if (!navigator.geolocation) {
        toast("GPS non supportato dal browser");
        elBaseSelect.value = "hotel_syd";
        setBase(BASES.hotel_syd);
        return;
      }
      toast("Richiedo GPSâ€¦");
      navigator.geolocation.getCurrentPosition((pos) => {
        const b = {
          label:"GPS (tu)",
          lat: pos.coords.latitude,
          lng: pos.coords.longitude,
          zoom: 14
        };
        setBase(b);
        toast("GPS OK");
      }, () => {
        toast("GPS non disponibile (permessi?) â€” torno all'hotel");
        elBaseSelect.value = "hotel_syd";
        setBase(BASES.hotel_syd);
      }, { enableHighAccuracy:true, timeout:12000, maximumAge:20000 });
      return;
    }

    setBase(BASES[v] || BASES.hotel_syd);
  });
}

loadSaved();
initMap();
buildChips();
wire();
render();
</script>

</body>
</html>
